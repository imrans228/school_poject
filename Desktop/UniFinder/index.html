{% extends "base.html" %}
{% block title %}–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–≤–æ–µ–≥–æ –ë—É–¥—É—â–µ–≥–æ üöÄ{% endblock %}

{% block content %}
<div class="animate-in fade-in duration-700">
    
    <div class="relative bg-gray-900 text-white rounded-b-3xl overflow-hidden shadow-2xl min-h-[500px] flex items-center mb-12">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1523050854058-8df90110c9f1?auto=format&fit=crop&q=80&w=1800')] bg-cover bg-center opacity-20"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-gray-900 via-gray-900/90 to-transparent"></div>
        
        <div class="relative z-10 p-8 md:p-16 max-w-4xl mx-auto md:mx-16">
            <span class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-purple-600/30 text-purple-300 border border-purple-600/50 mb-6 backdrop-blur-sm text-sm font-semibold tracking-wider">
                <i data-lucide="brain-circuit" class="w-4 h-4"></i> DataHub PRO
            </span>
            <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight">
                –ù–∞–π–¥–∏ —Å–≤–æ–π <br />
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-300">–ò–¥–µ–∞–ª—å–Ω—ã–π –í–£–ó</span>
            </h1>
            <p class="text-xl text-gray-300 mb-10 max-w-xl">
                –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏ AI-–ø–æ–º–æ—â–Ω–∏–∫–∞.
            </p>
            <div class="flex flex-col sm:flex-row gap-4">
                <a href="#ai-chat" class="px-8 py-4 rounded-xl font-extrabold transition-all transform active:scale-95 flex items-center justify-center gap-3 bg-white text-gray-900 hover:bg-gray-100 shadow-xl text-lg">
                    <i data-lucide="message-square" class="w-6 h-6 text-purple-600"></i> –°–ø—Ä–æ—Å–∏—Ç—å AI
                </a>
                <a href="{{ url_for('catalog') }}" class="px-8 py-4 rounded-xl font-extrabold transition-all transform active:scale-95 flex items-center justify-center gap-3 bg-purple-600 text-white hover:bg-purple-700 shadow-xl hover:shadow-purple-500/50 text-lg">
                    <i data-lucide="graduation-cap" class="w-6 h-6"></i> –ö–∞—Ç–∞–ª–æ–≥
                </a>
            </div>
        </div>
    </div>

    <div id="ai-chat" class="px-4 md:px-8 mb-20 max-w-5xl mx-auto">
        <div class="bg-gray-900 rounded-3xl shadow-2xl border border-purple-500/30 overflow-hidden flex flex-col md:flex-row min-h-[500px]">
            <div class="md:w-1/3 bg-gray-800 p-8 flex flex-col justify-between border-r border-gray-700">
                <div>
                    <div class="w-16 h-16 bg-purple-600 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-purple-500/20">
                        <i data-lucide="bot" class="w-8 h-8 text-white"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">AI-–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</h2>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        –Ø –∑–Ω–∞—é –≤—Å—ë –ø—Ä–æ —Ü–µ–Ω—ã, –≥—Ä–∞–Ω—Ç—ã –∏ –æ–±—â–µ–∂–∏—Ç–∏—è. –°–ø—Ä–∞—à–∏–≤–∞–π!
                    </p>
                </div>
                <div class="mt-8 space-y-3">
                    <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider">–ü—Ä–∏–º–µ—Ä—ã:</p>
                    <button onclick="fillPrompt('–ì–¥–µ –¥–µ—à–µ–≤–ª–µ —É—á–∏—Ç—å—Å—è –Ω–∞ IT?')" class="block w-full text-left text-sm text-purple-300 hover:text-white hover:bg-purple-600/20 px-3 py-2 rounded-lg transition-colors">‚ûú –ì–¥–µ –¥–µ—à–µ–≤–ª–µ —É—á–∏—Ç—å—Å—è –Ω–∞ IT?</button>
                    <button onclick="fillPrompt('–¢–æ–ø –≤—É–∑–æ–≤ –ø–æ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤—É')" class="block w-full text-left text-sm text-purple-300 hover:text-white hover:bg-purple-600/20 px-3 py-2 rounded-lg transition-colors">‚ûú –¢–æ–ø –≤—É–∑–æ–≤ –ø–æ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤—É</button>
                </div>
            </div>

            <div class="md:w-2/3 bg-gray-900 flex flex-col relative">
                <div id="chat-messages" class="flex-1 p-6 overflow-y-auto space-y-4 max-h-[500px] scroll-smooth">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center flex-shrink-0">
                            <i data-lucide="bot" class="w-4 h-4 text-white"></i>
                        </div>
                        <div class="bg-gray-800 text-gray-100 px-4 py-3 rounded-2xl rounded-tl-none max-w-[85%] text-sm shadow-sm">
                            –ü—Ä–∏–≤–µ—Ç! –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –≤—ã–±–æ—Ä–æ–º —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞. üéì
                        </div>
                    </div>
                </div>
                <div class="p-4 bg-gray-800/50 border-t border-gray-700">
                    <form id="chat-form" class="relative flex items-center gap-2">
                        <input type="text" id="user-input" class="w-full bg-gray-900 text-white border border-gray-600 rounded-xl pl-4 pr-12 py-3 focus:outline-none focus:border-purple-500 transition-all placeholder-gray-500" placeholder="–ù–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å..." required>
                        <button type="submit" class="absolute right-2 p-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition-colors shadow-lg">
                            <i data-lucide="send" class="w-4 h-4"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="px-4 md:px-8 mt-16 mb-20 max-w-7xl mx-auto">
        <h2 class="text-4xl font-extrabold text-gray-900 mb-10">‚ú® –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –í–£–ó—ã</h2>
        <div class="grid md:grid-cols-3 gap-8">
            {% for uni in popular_unis %}
            <a href="{{ url_for('detail', uni_id=uni.id) }}" class="group cursor-pointer bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-2xl hover:border-purple-300 transition-all duration-300">
                <div class="p-8 text-white text-center rounded-t-3xl bg-gradient-to-br {{ uni.color | default('from-gray-600 to-gray-800') }}">
                    <i data-lucide="building-2" class="w-9 h-9 mx-auto mb-3 opacity-90"></i> 
                    <div class="font-bold text-2xl tracking-wide line-clamp-1">{{ uni.name }}</div>
                </div>
                <div class="p-6">
                    <h3 class="font-extrabold text-xl text-gray-900 mb-2">{{ uni.fullName }}</h3>
                    <p class="text-purple-600 font-bold text-lg">{{ "{:,.0f}".format(uni.tuition) }} ‚Ç∏/–≥–æ–¥</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    const chatForm = document.getElementById('chat-form');
    const chatBox = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');

    function fillPrompt(text) {
        userInput.value = text;
        userInput.focus();
    }

    function appendMessage(text, sender) {
        const div = document.createElement('div');
        const isUser = sender === 'user';
        div.className = `flex items-start gap-3 ${isUser ? 'flex-row-reverse' : ''}`;
        
        const avatar = isUser 
            ? `<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><i data-lucide="user" class="w-4 h-4 text-gray-600"></i></div>`
            : `<div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center flex-shrink-0"><i data-lucide="bot" class="w-4 h-4 text-white"></i></div>`;

        const bubbleColor = isUser ? 'bg-purple-600 text-white rounded-tr-none' : 'bg-gray-800 text-gray-100 rounded-tl-none';
        
        let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');

        div.innerHTML = `${avatar}<div class="${bubbleColor} px-4 py-3 rounded-2xl max-w-[85%] text-sm shadow-sm">${formattedText}</div>`;
        
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
        if (typeof lucide !== 'undefined') lucide.createIcons();
    }

    function appendLoader() {
        const loader = document.createElement('div');
        loader.id = 'loader';
        loader.className = 'flex items-start gap-3';
        loader.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center flex-shrink-0"><i data-lucide="bot" class="w-4 h-4 text-white"></i></div>
            <div class="bg-gray-800 text-gray-400 px-4 py-3 rounded-2xl rounded-tl-none text-sm"><span class="animate-pulse">–î—É–º–∞—é...</span></div>
        `;
        chatBox.appendChild(loader);
        chatBox.scrollTop = chatBox.scrollHeight;
        if (typeof lucide !== 'undefined') lucide.createIcons();
    }

    function removeLoader() {
        const l = document.getElementById('loader');
        if (l) l.remove();
    }

    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = userInput.value.trim();
        if (!text) return;

        appendMessage(text, 'user');
        userInput.value = '';
        appendLoader();

        try {
            // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ù–ê –°–ï–†–í–ï–† (app.py)
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });
            const data = await response.json();
            removeLoader();
            appendMessage(data.response, 'ai');
        } catch (err) {
            removeLoader();
            appendMessage("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.", 'ai');
            console.error(err);
        }
    });
</script>
{% endblock %}
